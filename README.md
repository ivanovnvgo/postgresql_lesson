# postgresql_lesson
Домашние задания по курсу "Postgres для Go-разработчиков".

1.Начало работы с PostgreSQL, базовые инструменты, сравнение с другими СУБД.
Практические задания
1. Развернуть сервер PostgreSQL в Docker.
2. Создать пользователя и базу данных.
3. В базе из пункта 2 создать таблицу: не менее трёх столбцов различных типов. SQL-запрос на
создание таблицы добавить в текстовый файл class1_hometask.txt.
4. В таблицу из пункта 3 вставить не менее трёх строк. SQL-запрос на вставку добавить в
текстовый файл class1_hometask.txt.
5. Используя мета-команды psql, вывести список всех сущностей в базе данных из пункта 2.
Полученный список сущностей добавить в текстовый файл class1_hometask.txt.

2.Работа со структурой базы, CTE, Оценка занимаемого места.
Практические задания
Ожидается, что после выполнения этого практического задания у вас будет готова структура базы
данных, которая учитывает все связи и накладываемые ограничения. Желательно представлять,
какие примеры запросов могут приходить на базу данных.
1. Добавить ограничения foreign keys для всех имеющихся связей между таблицами в БД,
созданной в первом занятии. Ограничения можно добавлять как в существующую таблицу
(используя alter), так и изменив команду создания таблиц из прошлого урока. Команды на
добавление ограничений описать в файле schema.sql (редактировать файл из прошлого
урока).
2. Выявить необходимые ограничения (constraints) и добавить их в структуру базы данных.
Примером может быть ограничение на неотрицательность з/п. Как и в пункте 1, делайте это в
файле schema.sql.
3. Подготовить набор данных для вашей базы. Не обязательно много, главное покрыть
возможные примеры использования вашей базы. Описать запросы на добавление данных в
data.sql файле.
4. Оценить объём занимаемого места. Представить в виде отчёта по каждой таблице в вашей
базе в текстовом файле size_report.txt. В отчёте указать:
○ список таблиц;
○ количество строк в каждой таблице в соответствии со статистикой, которую собирает
Postgres;
○ объём диска, занимаемого каждой таблицей;
○ общий объём диска, занимаемого экземпляром Postgres.

3.Анализ выполнения запросов и индексация данных.
Практические задания
1. Составить 3–5 типовых запросов к данным в созданном проекте БД. Описать их в файле
queries.sql.
2. Предложить, на каких полях можно создать индексы для ускорения запросов из п. 1. Создать
требуемые индексы (не более трёх). Команды на создание индексов описать в файле
schema.sql (редактировать файл из прошлого урока).
3. Для каждого индекса из п. 2 показать анализ запроса до/после добавления индекса, оценить
занимаемый индексом объём диска. Отчёт представить в файле analysis.txt.

4.Использование PostgreSQL из Go приложения.
Практические задания
Код присылать как zip-архив с файлами, необходимыми для запуска генератора нагрузки (даже если
это один файл).
1. Реализовать генератор нагрузки, который нагружает базу типовыми запросами, подготовленными в рамках практического задания Урока 3.
2. Используя генератор нагрузки, измерить производительность (QPS) с разными значениями
для параметров MaxConns, MinConns pool'а соединений.
3. Подготовить отчет с информацией об используемом железе (используемый процессор,
количество ядер, объём оперативной памяти, объём жесткого диска) и о пропускной
способности сервера PostgreSQL для выбранного запроса. Представить отчет в файле
throughput.txt.

5.Структура приложения, тестирование, миграции, ORM.
Практические задания
Код присылать как zip-архив директории проекта, в которой вы вели работу (т. е. иерархия
директорий должна быть сохранена).
1. Реализовать приложение, которое реализует основной use-case вашей системы, т.е.
поддерживает выполнение типовых запросов покрыть один-два запроса). Необходимо (из файла queries.sql урока 3, достаточно реализовать только Storage Layer вашего приложения, т.е. только часть взаимодействия с базой данных.
2. Реализовать интеграционное тестирование функциональности по выборке данных из базы.
3. Реализовать автоматизацию миграции структуры базы данных (файл schema.sql из
предыдущих уроков). В файле README.md в корне проекта описать, как запускать миграцию
структуры базы данных.

Библиотеки для миграции баз данных:
github.com/golang-migrate/migrate
githab.com/jackc/tern
githab.com/rubenv/sql-migrate

Миграция запускается следующим образом:

go install -tags 'postgres' github.com/golang-migrate/migrate/v4/cmd/migrate@latest

migrate create -seq -ext sql -dir migrations init_schema
/home/user/gb.ru/postgresql_lesson/lesson5/migrations/000001_init_schema.up.sql
/home/user/gb.ru/postgresql_lesson/lesson5/migrations/000001_init_schema.down.sql

накатить миграцию используя контейнер c „golang-migrate“:
docker run \
-v «$(pwd)/lesson5/migrations»:/migrations \
migrate/migrate \
-path=/migrations/ \
-database postgres://admin:secret4All@localhost:5432/exam_session?sslmode=disable \
-verbose \
up

откатить миграцию:
docker run \
-v «$(pwd)/lesson5/migrations»:/migrations \
migrate/migrate \
-path=/migrations/ \
-database postgres://admin:secret4All@localhost:5432/exam_session?sslmode=disable \
-verbose \
down

Это изменение на одну миграцию. Если нужно накатить или откатить, например, 4 миграции, то это количество миграций 4 нужно указать после слова up или down:
...
up 4

или так:

...
down 4
